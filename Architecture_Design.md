# 시스템 아키텍처 설계서
## HCL Poker Clips 유튜브 동영상 자동 다운로드 앱

### 1. 전체 시스템 구성도

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│   사용자 UI     │◄──►│   웹 서버        │◄──►│   작업 스케줄러     │
│ (웹 브라우저)   │    │ (API 서버)       │    │ (Cron/Scheduler)    │
└─────────────────┘    └──────────────────┘    └─────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐    ┌─────────────────────┐
                    │   다운로드 큐    │◄──►│   다운로드 엔진     │
                    │   (Redis/RabbitMQ)│    │   (Headless Chrome) │
                    └──────────────────┘    └─────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │   데이터베이스   │
                    │   (PostgreSQL)   │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │   파일 저장소    │
                    │   (Local/Cloud)  │
                    └──────────────────┘
```

### 2. 구성 요소 상세 설명

#### 2.1 사용자 인터페이스 (Frontend)
- **기술 스택**: React.js 또는 Vue.js
- **기능**:
  - 실시간 다운로드 상태 모니터링
  - 다운로드 설정 및 일정 관리
  - 이력 조회 및 통계 제공
  - 알림 및 이벤트 표시
  - 사용자 인증 및 권한 관리

#### 2.2 웹 서버 (Backend API)
- **기술 스택**: Node.js (Express.js) 또는 Python (FastAPI)
- **기능**:
  - RESTful API 제공
  - 사용자 인증 및 세션 관리
  - 설정 정보 관리
  - 다운로드 요청 처리
  - 시스템 상태 모니터링

#### 2.3 작업 스케줄러
- **기술 스택**: Cron, Celery, Bull Queue 등
- **기능**:
  - 일일 자동 다운로드 작업 스케줄링
  - 작업 우선순위 관리
  - 실패 작업 재시도 처리
  - 작업 상태 추적

#### 2.4 다운로드 큐
- **기술 스택**: Redis, RabbitMQ, Bull Queue
- **기능**:
  - 다운로드 작업 큐 관리
  - 동시성 제어
  - 작업 진행 상태 추적
  - 오류 발생 시 재시도 처리

#### 2.5 다운로드 엔진
- **기술 스택**: Headless Chrome/Chromium, yt-dlp, ffmpeg
- **기능**:
  - 유튜브 영상 검색 및 URL 추출
  - 동영상 다운로드
  - 포맷 변환
  - 시그니처 추출 알고리즘 실행
  - 우회 전략 실행

#### 2.6 데이터베이스
- **기술 스택**: PostgreSQL 또는 MongoDB
- **기능**:
  - 사용자 정보 저장
  - 다운로드 기록 관리
  - 설정 정보 저장
  - 시스템 로그 저장

#### 2.7 파일 저장소
- **기술 스택**: 로컬 스토리지 또는 AWS S3, Google Cloud Storage
- **기능**:
  - 다운로드된 동영상 파일 저장
  - 파일 메타데이터 관리
  - 중복 방지를 위한 체크섬 관리
  - 스토리지 용량 관리

### 3. 데이터 흐름

#### 3.1 일일 자동 다운로드 흐름
1. 작업 스케줄러가 정해진 시간에 작업을 시작
2. 다운로드 엔진이 HCL Poker Clips 채널 접속
3. 새로운 동영상 검색 및 목록 가져오기
4. 각 동영상에 대해 다운로드 큐에 작업 추가
5. 다운로드 엔진이 큐에서 작업을 꺼내 다운로드 수행
6. 완료된 동영상은 파일 저장소에 저장
7. 다운로드 결과는 데이터베이스에 기록
8. 사용자에게 완료 알림 전송

#### 3.2 수동 다운로드 흐름
1. 사용자가 UI에서 수동 다운로드 요청
2. API 서버가 요청을 받고 다운로드 큐에 작업 추가
3. 다운로드 엔진이 큐에서 작업을 처리
4. 완료 후 결과를 데이터베이스에 저장
5. 사용자에게 실시간 진행 상태 업데이트

### 4. 보안 구현

#### 4.1 인증 및 권한 관리
- JWT (JSON Web Token) 기반 세션 관리
- OAuth 2.0 또는 OpenID Connect 통합
- 다단계 인증(MFA) 지원
- 세션 타임아웃 설정

#### 4.2 네트워크 보안
- HTTPS/TLS 암호화
- CORS 설정 관리
- API 속도 제한 (Rate Limiting)
- 공격 탐지를 위한 로깅

#### 4.3 데이터 보안
- 민감한 데이터 암호화 (AES-256)
- 데이터베이스 연결 암호화
- 접근 로그 관리
- 정기적인 보안 감사

### 5. 확장성 및 가용성

#### 5.1 수평 확장
- 마이크로서비스 아키텍처 설계
- 컨테이너 기반 배포 (Docker)
- 오케스트레이션 (Kubernetes)
- 로드 밸런싱

#### 5.2 고가용성
- 데이터베이스 클러스터링
- 백업 및 복구 전략
- 장애 감지 및 자동 복구
- 지역 분산 배포

### 6. 성능 고려사항

#### 6.1 다운로드 성능
- 병렬 다운로드 처리
- 효율적인 메모리 관리
- 캐시 전략 구현
- 스트리밍 다운로드 방식

#### 6.2 시스템 성능
- CPU/메모리 사용 최적화
- 데이터베이스 쿼리 성능 최적화
- 캐시 계층 구현
- 비동기 처리 설계

### 7. 모니터링 및 로깅

#### 7.1 시스템 모니터링
- CPU, 메모리, 디스크 사용률 모니터링
- 네트워크 대역폭 모니터링
- API 응답 시간 모니터링
- 장애 감지 및 알림

#### 7.2 애플리케이션 로깅
- 요청/응답 로그 기록
- 오류 로그 수집 및 분석
- 성능 지표 수집
- 사용자 활동 로그

### 8. 배포 아키텍처

#### 8.1 개발 환경
- 로컬 개발 서버
- 독립적인 개발 데이터베이스
- 단위 테스트 및 통합 테스트

#### 8.2 스테이징 환경
- 프로덕션과 유사한 환경
- 실제 유튜브 API 테스트
- 성능 테스트 환경

#### 8.3 운영 환경
- 고가용성 클러스터
- 자동 스케일링 구성
- 지속적 배포 파이프라인
- 백업 및 재해 복구 계획