# YouTube 동영상 다운로드 기능을 위한 제품 요구사항 문서 (PRD)
## HCL Poker Clips 자동 다운로드 앱 (2025년 12월 기준)

### 1. 문서 개요
- **문서 제목**: YouTube 동영상 다운로드 기능을 위한 제품 요구사항 문서
- **작성일**: 2025년 12월 10일
- **작성자**: [작성자 이름]
- **버전**: 1.0

### 2. 배경 및 목적
- **현재 상황**: YouTube는 2025년 12월 현재, PO 토큰(Proof of Origin 토큰), SABR 스트리밍, JavaScript challenge, 브라우저 지문 탐지 등 강력한 보안 정책을 적용하고 있음
- **문제 정의**: 기존 yt-dlp 기반 접근 방식으로는 다운로드 성공률이 30% 이하로 떨어짐
- **목적**: YouTube의 최신 보안 정책을 우회하여 75% 이상의 다운로드 성공률을 달성하는 안정적인 다운로드 시스템 구축

### 3. 핵심 기능 요구사항

#### 3.1 다중 다운로드 전략 (Multi-Strategy Approach)
- **전략 1: 고급 yt-dlp + 쿠키 기반**
  - 쿠키 파일 기반 인증 세션 유지
  - PO 토큰 우회 옵션 사용 (`no-youtube-po-token`)
  - 다양한 플레이어 클라이언트 사용 (`web`, `android`, `web_creator` 등)
  
- **전략 2: Playwright 기반 브라우저 자동화**
  - 실제 브라우저 인스턴스를 통한 JS challenge 해결
  - 브라우저 지문 무작위화
  - 동적 PO 토큰 추출

- **전략 3: HTTP 요청 직접 처리**
  - API 엔드포인트 직접 호출
  - 헤더 및 인증 정보 무작위화
  - 세그먼트 기반 다운로드 (SABR 우회)

#### 3.2 회피 전략 (Evasion Strategies)
- **IP 프록시 회전 시스템**: 최소 5개 이상의 프록시 서버 사용
- **브라우저 헤더 회전**: 무작위 User-Agent, Accept, Referer 등
- **요청 패턴 우회**: 인간 사용자 행동 패턴 시뮬레이션
- **시간 기반 지연**: 15-30초 사이 무작위 지연

#### 3.3 자동 복구 및 예외 처리
- **다중 재시도 메커니즘**: 5단계 재시도 전략
- **자동 전략 전환**: 실패 시 다른 다운로드 전략으로 자동 전환
- **상태 모니터링**: 실시간 다운로드 상태 및 오류 분석

### 4. 성능 및 성공 기준

#### 4.1 성공률 기준 (2025년 12월 기준)
- **기본 성공률 목표**: 75% 이상
- **목표 성공률**: 85% 이상
- **최소 성공률**: 60% 이상
- **성공률 측정 주기**: 일일 기준

#### 4.2 성능 기준
- **단일 동영상 처리 시간**: 평균 60초 이내
- **요청 간격**: 15-30초 (랜덤)
- **메모리 사용량**: 500MB 미만
- **CPU 사용률**: 80% 이하 (지속적 사용 기준)

#### 4.3 내결함성 기준
- **연속 실패 제한**: 3회 이상 연속 실패 시 일시 중지
- **자동 복구**: 10분 간격으로 재시도
- **오류 로깅**: 모든 실패에 대한 상세 로그 기록

### 5. 기술 설계

#### 5.1 시스템 아키텍처
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│   사용자 인터페이스  │◄──►│   요청 관리자     │◄──►│   전략 선택기      │
│ (GUI/web 인터페이스)│    │ (Request Manager)│    │ (Strategy Selector)│
└─────────────────┘    └──────────────────┘    └─────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐    ┌─────────────────────┐
                    │   회피 전략 관리자  │    │   다운로드 엔진들    │
                    │ (Evasion Manager) │    │ (Download Engines)  │
                    └──────────────────┘    └─────────────────────┘
                              │                          │
                              └──────────────────────────┘
                                       │
                              ┌──────────────────┐
                              │   결과 저장소     │
                              │ (Result Storage) │
                              └──────────────────┘
```

#### 5.2 다운로드 엔진 구조
- **yt-dlp 엔진 (v2025.12 이상)**: 최신 PO 토큰 우회 기능 포함
- **Playwright 엔진 (v1.50 이상)**: 브라우저 자동화 기반 challenge 해결
- **API 엔진**: 비공식 API를 통한 정보 추출
- **HTTP 엔진**: 직접 요청 기반 다운로드

#### 5.3 회피 전략 구현
- **IP 프록시 풀**: 다양한 위치의 프록시 서버 관리
- **브라우저 지문 우회**: Playwright 기반 브라우저 속성 조작
- **요청 패턴 변형**: 인간과 유사한 행동 패턴 시뮬레이션

### 6. 구현 계획

#### 6.1 단계별 개발 일정
- **1단계 (1주)**: 기반 아키텍처 및 전략 패턴 구현
- **2단계 (1주)**: yt-dlp 고급 옵션 및 쿠키 관리
- **3단계 (2주)**: Playwright 기반 브라우저 자동화
- **4단계 (1주)**: 프록시 회전 및 요청 분산 시스템
- **5단계 (1주)**: 자동 전략 전환 및 예외 처리
- **6단계 (1주)**: 통합 테스트 및 성능 최적화

#### 6.2 기술 스택
- **Backend**: Python 3.12+
- **Download Libraries**: yt-dlp (>=2025.12.0), Playwright (>=1.50)
- **Proxy Management**: 자체 개발 또는 proxybroker
- **Database**: SQLite 또는 PostgreSQL
- **Task Queue**: Celery 또는 자체 구현

### 7. 테스트 및 검증

#### 7.1 단위 테스트
- 각 다운로드 엔진 기능 검증
- 회피 전략 모듈 단위 테스트
- 오류 처리 및 복구 기능 테스트

#### 7.2 통합 테스트
- 100개 이상의 다양한 URL에 대한 테스트
- 다양한 보안 정책 환경에서의 테스트
- 성능 및 성공률 측정

#### 7.3 부하 테스트
- 연속 요청 시도에 대한 안정성 확인
- 장시간 운영 시 시스템 안정성 검증

### 8. 성공 지표 (KPIs)

#### 8.1 주요 성과 지표
- **다운로드 성공률**: 75% 이상 (기준: 2025년 12월)
- **요청 성공률**: 80% 이상
- **평균 처리 시간**: 60초 이내
- **시스템 가용성**: 99% 이상

#### 8.2 보조 지표
- **전략 전환 빈도**: 낮을수록 우수
- **프록시 활용률**: 균형 있게 분산
- **오류 발생률**: 5% 미만

### 9. 법적/윤리적 고려사항

#### 9.1 준수 사항
- **YouTube 이용 약관**: 개인용 다운로드만 허용
- **저작권 법률**: 공정 이용 범위 내 활용
- **지역 법규**: 다운로드 금지 지역에서의 기능 제한

#### 9.2 고지 사항
- **사용자 고지**: 개인용으로만 사용할 것 명시
- **법적 고지**: 이용 약관 동의 필수
- **책임 제한**: 사용자 책임 명확화

### 10. 위험 분석 및 대응

#### 10.1 기술적 위험
- **YouTube 정책 변경**: 정기적인 코드 업데이트 및 모니터링
- **IP 차단**: 다중 프록시, 요청 패턴 무작위화 대응
- **API 변경**: 플러그인 아키텍처로 대응

#### 10.2 운영 위험
- **법적 제재**: 사용자 책임 강조, 기능 제한
- **성능 저하**: 모니터링 및 자동 복구 기능 구현
- **의존성 문제**: 다양한 대체 기술 준비

### 11. 결론
YouTube의 2025년 12월 기준 강력한 보안 정책에 대응하기 위해, 다중 레이어 전략을 통한 다운로드 시스템 구축이 필요합니다. 이를 통해 75% 이상의 다운로드 성공률 달성 및 안정적인 운영이 가능할 것입니다.