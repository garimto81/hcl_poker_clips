# 회피 전략 설계서
## 유튜브 정책 변경 대응 전략

### 1. 개요

이 문서는 유튜브의 자동화 방지 정책 변경에 대응하기 위한 회피 전략을 상세히 설명합니다. HCL Poker Clips 채널 동영상을 일관되게 다운로드하기 위해 다양한 기술적 우회 방법을 설계하고 구현하는 것을 목표로 합니다.

### 2. 유튜브의 주요 방지 기술 분석

#### 2.1 시그니처 난독화 (Signature Obfuscation)
- 유튜브는 동영상 URL에 동적으로 생성된 시그니처를 추가하여 직접 접근을 차단합니다.
- 시그니처는 클라이언트 측에서 JavaScript로 계산되며, 자주 변경되고 난독화됩니다.
- 함수 이름이 자주 변경되고, 로직이 복잡해져 역공학을 어렵게 만듭니다.

#### 2.2 속도 제한 (Rate Limiting)
- IP 주소당 요청 횟수를 제한하여 과도한 자동 요청을 방지합니다.
- 요청 패턴이 자동화된 것으로 판단되면 임시 또는 영구 차단을 적용합니다.
- 다양한 엔드포인트에 서로 다른 제한이 적용됩니다.

#### 2.3 CAPTCHA 시스템
- 이상 징후가 감지되면 CAPTCHA를 통해 인간 사용자인지 확인합니다.
- reCAPTCHA는 사용자 행동을 분석하여 자동화 여부를 판단합니다.
- 브라우저 지문 분석을 통해 자동화 도구를 식별합니다.

#### 2.4 인증 및 헤더 검증
- 적절한 OAuth 토큰과 인증 헤더가 있어야 특정 엔드포인트에 접근할 수 있습니다.
- 세션 관리 및 쿠키가 비정상적으로 조작되었는지 감시합니다.
- 사용자 에이전트와 기타 헤더 값이 실제 브라우저와 일치하는지 검사합니다.

### 3. 회피 전략 설계

#### 3.1 시그니처 난독화 대응 전략

##### 3.1.1 자동 시그니처 추출 알고리즘
- **목표**: 유튜브의 JavaScript 시그니처 함수를 동적으로 추출하고 실행
- **구현**:
  - Headless 브라우저에서 실제 JavaScript를 실행하여 시그니처 계산
  - 정기적으로 시그니처 추출 함수의 변경 사항을 감지
  - 여러 버전의 추출 알고리즘 유지 및 자동 선택
- **예외 처리**:
  - 시그니처 추출 실패 시 대체 방법 호출
  - 추출 알고리즘 업데이트 필요 시 통보

##### 3.1.2 시그니처 알고리즘 캐싱 및 갱신
- **목표**: 반복적인 시그니처 추출을 최적화 하면서 변화에 대응
- **구현**:
  - 최근 성공한 시그니처 알고리즘 캐싱
  - 일정 시간이 지나면 갱신 시도
  - 캐시 실패 시 최신 알고리즘으로 재시도
- **갱신 전략**:
  - 정기 갱신 (예: 1시간 간격)
  - 실패 시 즉시 갱신

#### 3.2 속도 제한 회피 전략

##### 3.2.1 프록시 회전 시스템
- **목표**: 단일 IP에서의 요청을 분산하여 속도 제한 회피
- **구현**:
  - 다수의 프록시 서버 풀 관리
  - 요청 시 무작위 또는 회전 방식으로 프록시 선택
  - 실패한 프록시 자동 제외 및 복구 시도
- **프록시 관리**:
  - 프록시 품질 모니터링
  - 속도 및 안정성 기준에 따른 우선 순위 설정
  - 정기적인 품질 테스트

##### 3.2.2 요청 간격 조절
- **목표**: 인간 사용자와 유사한 요청 패턴을 만들어 속도 제한 회피
- **구현**:
  - 요청 사이 무작위 시간 지연
  - 인간 행동 패턴 기반의 간격 분포 (예: 가우시안 분포)
  - 요청 빈도 감지 시 자동 조절
- **지능형 조절**:
  - 오류율 기반 반응형 속도 조정
  - 일시적 차단 발생 시 감속 전략

##### 3.2.3 세션 관리
- **목표**: 정상적인 브라우저 세션 유지로 자동화 탐지 차단
- **구현**:
  - 실제 브라우저와 유사한 쿠키 유지
  - 세션 지속 시간 최적화
  - 세션 간 일관성 유지
- **세션 로테이션**:
  - 일정 주기로 세션 갱신
  - 비정상 탐지 시 세션 초기화

#### 3.3 CAPTCHA 대응 전략

##### 3.3.1 CAPTCHA 해결 서비스 통합
- **목표**: 자동으로 발생하는 CAPTCHA 문제 해결
- **구현**:
  - 2captcha, Anti-Captcha 등의 제3자 서비스 연동
  - CAPTCHA 감지 시 자동 해결 요청
  - 해결 실패 시 대체 전략
- **비용 관리**:
  - CAPTCHA 발생 빈도 모니터링
  - 해결 비용 최적화 전략

##### 3.3.2 브라우저 자동화 회피
- **목표**: 브라우저 자동화 탐지 회피
- **구현**:
  - 실제 브라우저와 유사한 설정 유지
  - 브라우저 지문 조정 (window.navigator 등)
  - 자동화 탐지 우회 스크립트 적용
- **지속성**:
  - 유튜브의 탐지 기법 변화에 대응
  - 정기적인 우회 스크립트 업데이트

#### 3.4 헤더 및 인증 우회 전략

##### 3.4.1 헤더 회전
- **목표**: 다양한 브라우저 헤더를 반복하여 일관성 있는 요청 생성
- **구현**:
  - 인기 브라우저 헤더 목록 유지
  - 요청 시 랜덤 또는 회전 방식 선택
  - 실제 브라우저와 일치하는 헤더 조합
- **헤더 조합**:
  - User-Agent, Accept, Referer, Origin 등 일관성 유지
  - 브라우저/OS 조합의 현실성 반영

##### 3.4.2 OAuth 및 인증 처리
- **목표**: 필요한 인증 정보를 안전하게 처리하면서 접근
- **구현**:
  - 실제 사용자 세션 모방
  - 필요한 토큰 값 동적 추출
  - 인증 만료 시 갱신
- **보안**:
  - 인증 정보 암호화 저장
  - 접근 권한 최소화

### 4. 회피 전략의 적응성 설계

#### 4.1 모니터링 및 감지
- **목표**: 차단 발생 상황을 빠르게 감지하고 대응
- **구현**:
  - HTTP 상태 코드 분석 (429, 403 등)
  - 응답 패턴 분석 (CAPTCHA 페이지 등)
  - 다운로드 성공/실패률 실시간 모니터링
- **감지 지표**:
  - 요청 실패율 증가
  - 특정 오류 유형 집중 발생
  - 응답 시간 변화 패턴

#### 4.2 자동 복구 및 전략 전환
- **목표**: 차단 발생 시 자동으로 대체 전략 활성화
- **구현**:
  - 다중 전략 우선순위 기반 전환
  - 실패 전략 일시 비활성화
  - 성공 전략 지속 사용
- **전략 평가**:
  - 각 전략의 성공률 비교
  - 시간 기반 전략 우선순위 조정

#### 4.3 커뮤니티 기반 업데이트
- **목표**: 외부 정보를 활용한 전략 개선
- **구현**:
  - 유튜브 API 변경 정보 수신
  - 오픈소스 프로젝트(yt-dlp 등) 변경 반영
  - 사용자 보고 기반 문제 해결
- **정보 공유**:
  - 알려진 시그니처 알고리즘 공유
  - 유효한 프록시 정보 업데이트

### 5. 위험 평가 및 완화

#### 5.1 기술 위험
- **문제**: 유튜브가 더 강력한 차단 기술 도입
- **완화 전략**:
  - 다중 대체 전략 준비
  - 빠른 대응을 위한 자동화된 업데이트 시스템
  - 보다 현실적인 사용자 행동 모방

#### 5.2 법적 위험
- **문제**: 저작권 침해 주장 또는 이용약관 위반
- **완화 전략**:
  - 개인 사용 목적 명확화
  - 원작자 허락 필요성 고려
  - 공정 이용 범위 내 활용

#### 5.3 운영 위험
- **문제**: 서비스 지속성을 위한 인프라 비용 증가
- **완화 전략**:
  - 효율적인 자원 사용
  - 자동화된 비용 모니터링
  - 적절한 성능과 비용 간 균형

### 6. 테스트 및 검증

#### 6.1 단위 테스트
- 시그니처 추출 알고리즘 테스트
- 프록시 회전 로직 테스트
- 헤더 회전 기능 테스트

#### 6.2 통합 테스트
- 실제 유튜브 채널에서 다운로드 테스트
- 다양한 네트워크 조건에서의 성능 테스트
- 장시간 운영 시 안정성 테스트

#### 6.3 회피 전략 검증
- 인위적으로 차단 조건 생성 후 회피 테스트
- 다양한 차단 상황 시뮬레이션
- 성공률 및 복구 시간 측정

이 회피 전략 설계서는 유튜브의 정책 변화에 유연하게 대응하며, HCL Poker Clips 채널의 동영상을 지속적으로 다운로드할 수 있도록 하는 데 초점을 맞추고 있습니다.